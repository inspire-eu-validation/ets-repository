<?xml version="1.0" encoding="utf-8"?>
<ExecutableTestSuite xmlns="http://www.interactive-instruments.de/etf/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="EID9af1c865-1cf0-43ff-9250-069df01b0948" xsi:schemaLocation="http://www.interactive-instruments.de/etf/2.0 https://resources.etf-validator.net/schema/v2/val/ignoreRef.xsd">
	<itemHash>bQ==</itemHash>
	<remoteResource>https://github.com/inspire-eu-validation/ets-repository/tree/master/data-tn/tn-gml</remoteResource>
	<localPath>/auto</localPath>
	<label>Conformance class: GML application schemas, Transport Networks</label>
	<description><![CDATA[This test suite examines the GML encoding of spatial objects specified in the INSPIRE GML application schema 'Transport Networks Simple'. Both currently approved GML application schema versions (3.0 and 4.0) are tested.<br/><br/>
<b>This is a draft version. It has limitations and is expected to contain errors.</b> Please report any issues or problems <a href="https://github.com/INSPIRE-MIF/helpdesk-validator/wiki/Your-feedback" target="_blank">in GitHub</a>.<br/><br/>
Known limitations are documented in the description of the applicable test case or test assertion. There is a general limitation in all assertions that extensions in additional application schemas are not fully supported.<br/><br/>
Source: <a href="http://inspire.ec.europa.eu/id/ats/data-tn/master/tn-gml" target="_blank">Conformance Class 'GML application schema, Transport Networks'</a><br/><br/>
Pre-requisite conformance classes:
<ul><li><a href="http://inspire.ec.europa.eu/id/ats/data/master/schemas" target="_blank">Conformance Class 'INSPIRE GML application schemas'</a></li></ul>]]></description>
  <reference>../../inspire-bsxets.xq</reference>
	<version>0.2.4</version>
	<author>PwC</author>
	<creationDate>2016-12-09T00:00:00Z</creationDate>
	<lastEditor>Consortium Bilbomatica y Guadaltel</lastEditor>
	<lastUpdateDate>2024-02-21T15:00:00Z</lastUpdateDate>
	<tags>
		<tag ref="EID54d5f755-e20c-40a7-ab72-5600c71dd049"/>
	</tags>
	<testDriver ref="EID4dddc9e2-1b21-40b7-af70-6a2d156ad130"/>
	<translationTemplateBundle ref="EID70a263c0-0ad7-42f2-9d4d-0d8a4ca71b52"/>
	<ParameterList name="ETF Standard Parameters for XML test objects">
		<parameter name="files_to_test" required="true">
			<defaultValue>.*</defaultValue>
			<description ref="TR.filesToTest"/>
			<allowedValues>.*</allowedValues>
			<type>string</type>
		</parameter>
		<parameter name="tests_to_execute" required="false">
			<defaultValue>.*</defaultValue>
			<description ref="TR.testsToExecute"/>
			<allowedValues>.*</allowedValues>
			<type>string</type>
		</parameter>
	</ParameterList>
	<supportedTestObjectTypes>
		<testObjectType ref="EIDe1d4a306-7a78-4a3b-ae2d-cf5f0810853e"/>
	</supportedTestObjectTypes>
	<dependencies>
		<executableTestSuite ref="EID09820daf-62b2-4fa3-a95f-56a0d2b7c4d8"/>
	</dependencies>
	<testModules>
		<TestModule id="EID5ace13a9-66c5-40ea-9625-174f5e10b56f">
			<label>IGNORE</label>
			<description>IGNORE</description>
			<parent ref="EID9af1c865-1cf0-43ff-9250-069df01b0948"/>
			<testCases>
				<TestCase id="EID92ed634f-86bf-4b29-a1bb-ae2e7c4554ea">
					<label>Basic test</label>
					<description>Verify that the spatial data set contains at least one Transport Network feature.</description>
					<parent ref="EID5ace13a9-66c5-40ea-9625-174f5e10b56f"/>
					<testSteps>
						<TestStep id="EIDcbc1ae16-3ac4-4c46-bd48-56a94fae5d94">
							<label>IGNORE</label>
							<description>IGNORE</description>
							<parent ref="EID92ed634f-86bf-4b29-a1bb-ae2e7c4554ea"/>
							<statementForExecution>not applicable</statementForExecution>
							<testItemType ref="EIDf483e8e8-06b9-4900-ab36-adad0d7f22f0"/>
							<testAssertions>
								<TestAssertion id="EID7425c468-5ec3-4cb0-bae9-acc066a2d8ee">
									<label>tn-gml.a.1: Transport Network feature in dataset</label>
									<description><![CDATA[Check that the set of features in the spatial data set is not empty.<br/><br/>
Source: <a href="http://inspire.ec.europa.eu/id/ats/data-tn/master/tn-gml/basic" target="_blank">Abstract Test Case 'Basic test'</a>, <a href="http://inspire.ec.europa.eu/documents/Data_Specifications/INSPIRE_DataSpecification_TN_v3.2.pdf">INSPIRE Data Specification on Transport Networks, A.1.1, (A.6.1)</a>]]></description>
									<parent ref="EIDcbc1ae16-3ac4-4c46-bd48-56a94fae5d94"/>
									<expectedResult>NOT_APPLICABLE</expectedResult>
									<expression>
let $featuresFromAppSchema := $features[descendant-or-self::*:AccessRestriction | descendant-or-self::*:ConditionOfFacility | descendant-or-self::*:MaintenanceAuthority | descendant-or-self::*:MarkerPost | descendant-or-self::*:OwnerAuthority | descendant-or-self::*:RestrictionForVehicles | descendant-or-self::*:TrafficFlowDirection | descendant-or-self::*:TransportNetwork | descendant-or-self::*:VerticalPosition | descendant-or-self::*:ERoad | descendant-or-self::*:FormOfWay | descendant-or-self::*:FunctionalRoadClass | descendant-or-self::*:NumberOfLanes | descendant-or-self::*:Road | descendant-or-self::*:RoadArea | descendant-or-self::*:RoadLink | descendant-or-self::*:RoadLinkSequence | descendant-or-self::*:RoadName | descendant-or-self::*:RoadNode | descendant-or-self::*:RoadServiceArea | descendant-or-self::*:RoadServiceType | descendant-or-self::*:RoadSurfaceCategory | descendant-or-self::*:RoadWidth | descendant-or-self::*:SpeedLimit | descendant-or-self::*:VehicleTrafficArea | descendant-or-self::*:DesignSpeed | descendant-or-self::*:NominalTrackGauge | descendant-or-self::*:NumberOfTracks | descendant-or-self::*:RailwayArea | descendant-or-self::*:RailwayElectrification | descendant-or-self::*:RailwayLine | descendant-or-self::*:RailwayLink | descendant-or-self::*:RailwayLinkSequence | descendant-or-self::*:RailwayNode | descendant-or-self::*:RailwayStationArea | descendant-or-self::*:RailwayStationCode | descendant-or-self::*:RailwayStationNode | descendant-or-self::*:RailwayType | descendant-or-self::*:RailwayUse | descendant-or-self::*:RailwayYardArea | descendant-or-self::*:RailwayYardNode | descendant-or-self::*:CablewayLink | descendant-or-self::*:CablewayLinkSequence | descendant-or-self::*:CablewayLinkSet | descendant-or-self::*:CablewayNode | descendant-or-self::*:Beacon | descendant-or-self::*:Buoy | descendant-or-self::*:CEMTClass | descendant-or-self::*:ConditionOfWaterFacility | descendant-or-self::*:FairwayArea | descendant-or-self::*:FerryCrossing | descendant-or-self::*:FerryUse | descendant-or-self::*:InlandWaterway | descendant-or-self::*:MarineWaterway | descendant-or-self::*:PortArea | descendant-or-self::*:PortNode | descendant-or-self::*:RestrictionForWaterVehicles | descendant-or-self::*:TrafficSeparationSchemeCrossing | descendant-or-self::*:TrafficSeparationSchemeLane | descendant-or-self::*:TrafficSeparationSchemeRoundabout | descendant-or-self::*:TrafficSeparationSchemeSeparator | descendant-or-self::*:WaterLinkSequence | descendant-or-self::*:WaterTrafficFlowDirection | descendant-or-self::*:WaterwayLink | descendant-or-self::*:WaterwayNode | descendant-or-self::*:Type | descendant-or-self::*:AerodromeArea | descendant-or-self::*:AerodromeCategory | descendant-or-self::*:AerodromeNode | descendant-or-self::*:AerodromeType | descendant-or-self::*:AirLinkSequence | descendant-or-self::*:AirRoute | descendant-or-self::*:AirRouteLink | descendant-or-self::*:AirspaceArea | descendant-or-self::*:ApronArea | descendant-or-self::*:ConditionOfAirFacility | descendant-or-self::*:DesignatedPoint | descendant-or-self::*:ElementLength | descendant-or-self::*:ElementWidth | descendant-or-self::*:FieldElevation | descendant-or-self::*:InstrumentApproachProcedure | descendant-or-self::*:LowerAltitudeLimit | descendant-or-self::*:Navaid | descendant-or-self::*:ProcedureLink | descendant-or-self::*:RunwayArea | descendant-or-self::*:RunwayCentrelinePoint | descendant-or-self::*:StandardInstrumentArrival | descendant-or-self::*:StandardInstrumentDeparture | descendant-or-self::*:SurfaceComposition | descendant-or-self::*:TaxiwayArea | descendant-or-self::*:TouchDownLiftOff | descendant-or-self::*:UpperAltitudeLimit | descendant-or-self::*:UseRestriction]
return
 (if ($featuresFromAppSchema) then 'PASSED' else 'FAILED',
  if (not($featuresFromAppSchema)) then local:addMessage('TR.noFeature', map { 'theme': 'Transport Networks' }) else ())
									</expression>
									<testItemType ref="EIDf0edc596-49d2-48d6-a1a1-1ac581dcde0a"/>
									<translationTemplates>
										<translationTemplate ref="TR.noFeature"/>
									</translationTemplates>
								</TestAssertion>
							</testAssertions>
						</TestStep>
					</testSteps>
				</TestCase>
				<TestCase id="EIDb14f9cfb-e179-410c-a13f-7f1335b4fd61">
					<label>Validation against INSPIRE official schema</label>
					<description>Verify that all XML documents validate against the latest INSPIRE official schema(s).</description>
					<parent ref="EID5ace13a9-66c5-40ea-9625-174f5e10b56f"/>
					<testSteps>
						<TestStep id="EID96809a4e-afbf-47d7-9331-f2e46506bb8b">
							<label>IGNORE</label>
							<description>IGNORE</description>
							<parent ref="EIDb14f9cfb-e179-410c-a13f-7f1335b4fd61"/>
							<statementForExecution>not applicable</statementForExecution>
							<testItemType ref="EIDf483e8e8-06b9-4900-ab36-adad0d7f22f0"/>
							<testAssertions>
								<TestAssertion id="EIDb4e6d860-b700-4cfa-b49a-defcb34339a9">
									<label>tn-gml.b.1: validate XML documents against official schema</label>
									<description><![CDATA[Validate each document against the latest INSPIRE official schema(s), using strict XML schema validation. The official schemas for this data theme are: 
										<ul><li>Air Transport Network: <a href="https://inspire.ec.europa.eu/schemas/tn-a/4.0/AirTransportNetwork.xsd" target="_blank">https://inspire.ec.europa.eu/schemas/tn-a/4.0/AirTransportNetwork.xsd</a></li>
										<li>Cable Transport Network: <a href="https://inspire.ec.europa.eu/schemas/tn-c/4.0/CableTransportNetwork.xsd" target="_blank">https://inspire.ec.europa.eu/schemas/tn-c/4.0/CableTransportNetwork.xsd</a></li>
										<li>Railway Transport Network: <a href="https://inspire.ec.europa.eu/schemas/tn-ra/5.0/RailwayTransportNetwork.xsd" target="_blank">https://inspire.ec.europa.eu/schemas/tn-ra/5.0/RailwayTransportNetwork.xsd</a></li>
										<li>Road Transport Network: <a href="https://inspire.ec.europa.eu/schemas/tn-ro/5.0/RoadTransportNetwork.xsd" target="_blank">https://inspire.ec.europa.eu/schemas/tn-ro/5.0/RoadTransportNetwork.xsd</a></li>
										<li>Water Transport Network: <a href="https://inspire.ec.europa.eu/schemas/tn-w/5.0/WaterTransportNetwork.xsd" target="_blank">https://inspire.ec.europa.eu/schemas/tn-w/5.0/WaterTransportNetwork.xsd</a></li>
									</ul><br/><br/>
Relevant requirements:
<ul>
<li>IR Requirement Article 3: Common Types. Types that are common to several of the themes listed in Annexes I, II and III to Directive 2007/2/EC shall conform to the definitions and constraints and include the attributes and association roles set out in Annex I.</li>
<li>IR Requirement Article 4 (2): Types for the Exchange and Classification of Spatial Objects. Spatial object types and data types shall comply with the definitions and constraints and include the attributes and association roles set out in the Annexes.</li>
<li>IR Requirement Article 4 (3): Types for the Exchange and Classification of Spatial Objects. The enumerations and code lists used in attributes or association roles of spatial object types or data types shall comply with the definitions and include the values set out in Annex II. The enumeration and code list values are uniquely identified by language-neutral mnemonic codes for computers. The values may also include a language-specific name to be used for human interaction.</li>
<li>IR Requirement Article 5 (2): Types. Types that are a sub-type of another type shall also include all this type‘s attributes and association roles.</li>
<li>IR Requirement Article 5 (3): Types. Abstract types shall not be instantiated.</li>
<li>IR Requirement Article 6 (5): Code Lists and Enumerations. Attributes or association roles of spatial object types or data types that have an enumeration type may only take values from the lists specified for the enumeration type.</li>
<li>IR Requirement Article 9 (1): Identifier Management. The data type Identifier defined in Section 2.1 of Annex I shall be used as a type for the external object identifier of a spatial object.</li>
<li>TG Requirement 1: Spatial object types and data types shall comply with the multiplicities defined for the attributes and association roles in this section.</li>
<li>TG Requirement 6: Data instance (XML) documents shall validate without error against the provided XML schema.</li>
</ul><br/><br/>
Source: <a href="http://inspire.ec.europa.eu/id/ats/data-tn/master/tn-gml/official-schema-validation" target="_blank">Abstract Test Case 'Validation against INSPIRE official schema'</a>]]></description>
									<parent ref="EID96809a4e-afbf-47d7-9331-f2e46506bb8b"/>
									<expectedResult>NOT_APPLICABLE</expectedResult>
									<expression>
let $errors := (for $file in $db
 return
 try { 
  let $root := $file/element()
  let $logentry := local:log('Validating ' || local:filename($root))
  let $start := prof:current-ms()
	let $schema := local:getXSDSchemaWithVersion( ("tn-a", "tn-c", "tn-ra", "tn-ro", "tn-w" ), ("AirTransportNetwork", "CableTransportNetwork", "RailwayTransportNetwork", "RoadTransportNetwork", "WaterTransportNetwork"), ("4.0", "4.0", "5.0", "5.0", "5.0") )

  let $query := "declare variable $file external; declare variable $schema external; validate:xsd-info($file,$schema)"
  let $messages := xquery:eval($query, map{ 'file': $file, 'schema': $schema }, map{ 'timeout': 60 })
  (:let $messages := validate:xsd-info($file):)
  let $duration := prof:current-ms()-$start
  let $errors := count($messages)
  let $logentry := local:log('Duration: ' || $duration || ' ms. Errors: ' || $errors || '.')
  return
   if ($errors&gt;0 and exists($logFile)) then
    (local:addMessage('TR.invalidSchema', map { 'filename': local:filename($root), 'count': string($errors) }),
     for $message in $messages return local:addMessage('TR.xmlSchemaError', map { 'filename': local:filename($root), 'error': $message }))
   else ()
 } catch * 
 { 
	let $logerror := local:log('Exception: ' || $err:description)
   return local:addMessage('TR.timeoutFileOperation', map { 'filename': local:filename($file/element()), 'description': $err:description })
 }
 )[position() le $limitErrors]						 
return
(if ($errors) then 'FAILED' else 'PASSED',
 local:error-statistics('TR.filesWithErrors', count($errors[@ref eq 'TR.invalidSchema'])),
 $errors[position() le $limitErrors])
									</expression>
									<testItemType ref="EIDf0edc596-49d2-48d6-a1a1-1ac581dcde0a"/>
									<translationTemplates>
										<translationTemplate ref="TR.invalidSchema"/>
										<translationTemplate ref="TR.filesWithErrors"/>
									</translationTemplates>
								</TestAssertion>
							</testAssertions>
						</TestStep>
					</testSteps>
				</TestCase>
			</testCases>
		</TestModule>
	</testModules>
</ExecutableTestSuite>
