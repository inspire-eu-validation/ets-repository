<?xml version="1.0" encoding="utf-8"?>
<ExecutableTestSuite xmlns="http://www.interactive-instruments.de/etf/2.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="EID529582ee-f03f-4386-acd3-b880c26bcb31" xsi:schemaLocation="http://www.interactive-instruments.de/etf/2.0 https://resources.etf-validator.net/schema/v2/val/ignoreRef.xsd">
	<itemHash>bQ==</itemHash>
	<remoteResource>https://github.com/inspire-eu-validation/ets-repository/tree/master/data-su/su-grid-as</remoteResource>
	<localPath>/auto</localPath>
	<label>Conformance class: Application schema, Statistical Units Grid</label>
	<description><![CDATA[This test suite examines requirements associated with the application schema.<br/><br/>
<b>This is a draft version. It has limitations and is expected to contain errors.</b> Please report any issues or problems <a href="https://github.com/INSPIRE-MIF/helpdesk-validator" target="_blank">in GitHub</a>.<br/><br/>
Known limitations are documented in the description of the applicable test case or test assertion. There is a general limitation in all assertions that extensions in additional application schemas are only supported, if the unqualified name of the feature type in the extension is the same as the name of the feature type in the INSPIRE application schema.<br/><br/>
Source: <a href="http://inspire.ec.europa.eu/id/ats/data-br/master/su-grid-as" target="_blank">Conformance Class 'Application Schema, Statistical Units Grid'</a><br/><br/>
Pre-requisite conformance classes:
<ul><li><a href="http://inspire.ec.europa.eu/id/ats/data-su/master/su-as" target="_blank">Conformance Class 'Application Schema, Statistical Units Base'</a></li></ul>]]></description>
	<reference>../../inspire-noggeo-bsxets.xq</reference>
	<version>0.1.0</version>
	<author>Consortium Bilbomatica, Guadaltel y Geograma</author>
	<creationDate>2021-04-16T08:00:00Z</creationDate>
	<lastEditor>Consortium Bilbomatica, Guadaltel y Geograma</lastEditor>
	<lastUpdateDate>2021-04-16T08:00:00Z</lastUpdateDate>
	<tags>
		<tag ref="EIDaba29c5b-b0e6-4e2c-908d-ea6c7df08824"/>
	</tags>
	<testDriver ref="EID4dddc9e2-1b21-40b7-af70-6a2d156ad130"/>
	<translationTemplateBundle ref="EID70a263c0-0ad7-42f2-9d4d-0d8a4ca71b52"/>
	<ParameterList name="ETF Standard Parameters for XML test objects">
		<parameter name="files_to_test" required="true">
			<defaultValue>.*</defaultValue>
			<description ref="TR.filesToTest"/>
			<allowedValues>.*</allowedValues>
			<type>string</type>
		</parameter>
		<parameter name="tests_to_execute" required="false">
			<defaultValue>.*</defaultValue>
			<description ref="TR.testsToExecute"/>
			<allowedValues>.*</allowedValues>
			<type>string</type>
		</parameter>
	</ParameterList>
	<supportedTestObjectTypes>
		<testObjectType ref="EIDe1d4a306-7a78-4a3b-ae2d-cf5f0810853e"/>
	</supportedTestObjectTypes>
	<dependencies>
		<executableTestSuite ref="EID4a8fffca-2603-4a16-b8e4-6e2c659e50be"/>
	</dependencies>
	<testModules>
		<TestModule id="EID9be16e89-ab2c-43e2-8b6c-acc81f5d15d9">
			<label>IGNORE</label>
			<description>IGNORE</description>
			<parent ref="EID529582ee-f03f-4386-acd3-b880c26bcb31"/>
			<testCases>
				<TestCase id="EID361032ad-ee1d-41df-bdaf-3f0820cf559d">
					<label>Constraints</label>
					<description>Verify that the features provided in the dataset adhere to the constraints specified in the INSPIRE application schema.</description>
					<parent ref="EID9be16e89-ab2c-43e2-8b6c-acc81f5d15d9"/>
					<testSteps>
						<TestStep id="EIDbaa49c79-ba26-42d9-845e-a2e4d1c92a9a">
							<label>IGNORE</label>
							<description>IGNORE</description>
							<parent ref="EID361032ad-ee1d-41df-bdaf-3f0820cf559d"/>
							<statementForExecution>not applicable</statementForExecution>
							<testItemType ref="EIDf483e8e8-06b9-4900-ab36-adad0d7f22f0"/>
							<testAssertions>
								<TestAssertion id="EIDcb27c5b4-6776-412b-b9ed-3dcc90acbfab">
									<label>su-grid-as.a.1: spatialRepresentation</label>
									<description><![CDATA[Check that at least one of the attributes <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#code>code</a>, <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#geographicalPosition>geographicalPosition</a>, <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#gridPosition>gridPosition</a> or <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#geometry>geometry</a> is provided.<br/><br/>
									Relevant requirements:
									<ul><li>IR Requirement Article 4 (2): Types for the Exchange and Classification of Spatial Objects. Spatial object types and data types shall comply with the definitions and constraints and include the attributes and association roles set out in the Annexes.</li></ul>
									Source: <a href="http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints" target="_blank">Abstract Test Case 'Constraints'</a>, <a href="http://inspire.ec.europa.eu/documents/Data_Specifications/INSPIRE_DataSpecification_SU_v3.0.pdf">INSPIRE Data Specification on Statistical Units, A.1.6</a>]]></description>
									<parent ref="EIDbaa49c79-ba26-42d9-845e-a2e4d1c92a9a"/>
									<expectedResult>NOT_APPLICABLE</expectedResult>
									<expression>

let $property_string := 'spatialRepresentation'
let $property_stringc := 'code'
let $property_stringgep := 'geographicalPosition'
let $property_stringgeo := 'geometry'
let $property_stringgrp := 'gridPosition'
let $features_selected := $features[self::su-grid:StatisticalGridCell]


let $messages :=
	for $feature in $features_selected
		let $envDomc := $feature/su-grid:code
		let $envDomgep := $feature/su-grid:geographicalPosition
		let $envDomgeo := $feature/su-grid:geometry
		let $envDomgrp := $feature/su-grid:gridPosition
		
		return
			if (not(exists($envDomc))) then
				local:addMessage('TR.missingElement',  map {'filename': local:filename($feature), 'featureType':local-name($feature), 'gmlid': string($feature/@*:id), 'property': $property_stringc})
			else if (count($envDomc) > 1) then
				local:addMessage('TR.wrongMultiplicity',  map {'filename': local:filename($feature), 'featureType':local-name($feature), 'gmlid': string($feature/@*:id), 'element': $property_stringc, 'multiplicity': 1, 'count': count($envDomc)})
			else if (not(exists($envDomgep))) then
				local:addMessage('TR.missingElement',  map {'filename': local:filename($feature), 'featureType':local-name($feature), 'gmlid': string($feature/@*:id), 'property': $property_stringgep})
			else if (count($envDomgep) > 1) then
				local:addMessage('TR.wrongMultiplicity',  map {'filename': local:filename($feature), 'featureType':local-name($feature), 'gmlid': string($feature/@*:id), 'element': $property_stringgep, 'multiplicity': 1, 'count': count($envDomgep)})
			else if (not(exists($envDomgeo))) then
				local:addMessage('TR.missingElement',  map {'filename': local:filename($feature), 'featureType':local-name($feature), 'gmlid': string($feature/@*:id), 'property': $property_stringgeo})
			else if (count($envDomgeo) > 1) then
				local:addMessage('TR.wrongMultiplicity',  map {'filename': local:filename($feature), 'featureType':local-name($feature), 'gmlid': string($feature/@*:id), 'element': $property_stringgeo, 'multiplicity': 1, 'count': count($envDomgeo)})
			else if (count($envDomgrp) > 1) then
				local:addMessage('TR.wrongMultiplicity',  map {'filename': local:filename($feature), 'featureType':local-name($feature), 'gmlid': string($feature/@*:id), 'element': $property_stringgrp, 'multiplicity': '0 or 1', 'count': count($envDomgrp)})
			else if (not(has-children($envDomc)) and not(has-children($envDomgep)) and not(has-children($envDomgeo)) and not(has-children($envDomgrp))) then
				local:addMessage('TR.constraintViolation', map { 'filename': local:filename($feature), 'featureType':local-name($feature), 'gmlid': string($feature/@*:id), 'constraint': 'at least one of the attributes code, geographicalPosition, gridPosition or geometry is provided', 'additionalInfo': ''})
			else ()


						
return
(if ($messages) then 'FAILED' else 'PASSED',
local:error-statistics('TR.recordsWithErrors', count(fn:distinct-values($messages//etf:argument[@token='id']/text()))),
$messages)

									</expression>
									<testItemType ref="EIDf0edc596-49d2-48d6-a1a1-1ac581dcde0a"/>
									<translationTemplates>
										<translationTemplate ref="TR.constraintViolation"/>
									</translationTemplates>
								</TestAssertion>
								<TestAssertion id="EID08951320-a070-4e85-8811-398b0d294047">
									<label>su-grid-as.a.2: resolutionType</label>
									<description><![CDATA[Check that if the <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#EPSG>coordinate reference system</a> of the StatisticalGrid is a projected one, the resolution shall be a <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#length>length</a>. Otherwise, it shall be an <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#angle>angle</a>.<br/><br/>
									Relevant requirements:
									<ul><li>IR Requirement Article 4 (2): Types for the Exchange and Classification of Spatial Objects. Spatial object types and data types shall comply with the definitions and constraints and include the attributes and association roles set out in the Annexes.</li></ul>
									Source: <a href="http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints" target="_blank">Abstract Test Case 'Constraints'</a>, <a href="http://inspire.ec.europa.eu/documents/Data_Specifications/INSPIRE_DataSpecification_SU_v3.0.pdf">INSPIRE Data Specification on Statistical Units, A.1.6</a>]]></description>
									<parent ref="EIDbaa49c79-ba26-42d9-845e-a2e4d1c92a9a"/>
									<expectedResult>NOT_APPLICABLE</expectedResult>
									<expression>NOT_APPLICABLE</expression>
									<testItemType ref="EIDb48eeaa3-6a74-414a-879c-1dc708017e11"/>
								</TestAssertion>
								<TestAssertion id="EIDf41456ab-0cef-426c-8802-b192a46ae285">
									<label>su-grid-as.a.3: gridPositionRange</label>
									<description>
										<![CDATA[Check that the cell position is within the grid, according to its width and heightç.<br/><br/>
										Relevant requirements:
										<ul><li>IR Requirement Article 4 (2): Types for the Exchange and Classification of Spatial Objects. Spatial object types and data types shall comply with the definitions and constraints and include the attributes and association roles set out in the Annexes.</li></ul>
										Source: <a href="http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints" target="_blank">Abstract Test Case 'Constraints'</a>, <a href="http://inspire.ec.europa.eu/documents/Data_Specifications/INSPIRE_DataSpecification_SU_v3.0.pdf">INSPIRE Data Specification on Statistical Units, A.1.6</a>]]></description>
									<parent ref="EIDbaa49c79-ba26-42d9-845e-a2e4d1c92a9a"/>
									<expectedResult>NOT_APPLICABLE</expectedResult>
									<expression>'NOT_APPLICABLE'</expression>
									<testItemType ref="EIDb48eeaa3-6a74-414a-879c-1dc708017e11"/>
								</TestAssertion>
								<TestAssertion id="EIDf4f1ee97-db35-43a5-ab0c-a28facda10f2">
									<label>su-grid-as.b.4: spatialRepresentationsConsistency</label>
									<description>
										<![CDATA[Check that where several spatial representations are provided (<a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#code>code</a>, <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#geographicalPosition>geographicalPosition</a>, <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#gridPosition>gridPosition</a> and <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#geometry>geometry</a>), they are consistent.<br/><br/>
										Relevant requirements:
										<ul><li>IR Requirement Article 4 (2): Types for the Exchange and Classification of Spatial Objects. Spatial object types and data types shall comply with the definitions and constraints and include the attributes and association roles set out in the Annexes.</li></ul>
										Source: <a href="http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints" target="_blank">Abstract Test Case 'Constraints'</a>, <a href="http://inspire.ec.europa.eu/documents/Data_Specifications/INSPIRE_DataSpecification_SU_v3.0.pdf">INSPIRE Data Specification on Statistical Units, A.1.6</a>]]></description>
									<parent ref="EIDbaa49c79-ba26-42d9-845e-a2e4d1c92a9a"/>
									<expectedResult>NOT_APPLICABLE</expectedResult>
									<expression>'NOT_APPLICABLE'</expression>
									<testItemType ref="EIDb48eeaa3-6a74-414a-879c-1dc708017e11"/>
								</TestAssertion>
								<TestAssertion id="EIDf75d4ceb-b6ce-434f-9f74-0a687b7fffc9">
									<label>su-grid-as.a.5: cellCode</label>
									<description>
										<![CDATA[Check that the <a href= http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints#code>code</a> is composed of:
										<ol  style="list-style-type:lower-roman"><li>A coordinate reference system part, represented by the word CRS, followed by the EPSG code.</li>
<li>A resolution and position part:</li>
<ul><li>If the coordinate reference system is projected, the word RES followed by the grid resolution in meters and the letter m. Then, the letter N followed by the northing value in meters, and the letter E followed by the easting value in meters.</li>
<li>If the coordinate reference system is not projected, the word RES followed by the grid resolution in degree-minute-second, followed by the word dms. Then the word LON followed by the longitude value in degree-minute-second, and word LAT followed by the latitude value in degree-minute-second.</li></ul></ol>
For both cases, the given position shall be the position of the lower left cell corner.
<br/><br/>
										Relevant requirements:
										<ul><li>IR Requirement Article 4 (2): Types for the Exchange and Classification of Spatial Objects. Spatial object types and data types shall comply with the definitions and constraints and include the attributes and association roles set out in the Annexes.</li></ul>
										Source: <a href="http://inspire.ec.europa.eu/id/ats/data-su/master/su-grid-as/constraints" target="_blank">Abstract Test Case 'Constraints'</a>, <a href="http://inspire.ec.europa.eu/documents/Data_Specifications/INSPIRE_DataSpecification_SU_v3.0.pdf">INSPIRE Data Specification on Statistical Units, A.1.6</a>]]></description>
									<parent ref="EIDbaa49c79-ba26-42d9-845e-a2e4d1c92a9a"/>
									<expectedResult>NOT_APPLICABLE</expectedResult>
									<expression>'NOT_APPLICABLE'</expression>
									<testItemType ref="EIDb48eeaa3-6a74-414a-879c-1dc708017e11"/>
								</TestAssertion>
							</testAssertions>
						</TestStep>
					</testSteps>
				</TestCase>
			</testCases>
		</TestModule>
	</testModules>
</ExecutableTestSuite>